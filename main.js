(()=>{"use strict";var e={baseUrl:"https://mesto.nomoreparties.co/v1/higher-front-back-dev",headers:{authorization:"09c8855e-21c8-4804-bebe-281ce3fe62b4","Content-Type":"application/json"}};function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.onDelete,r=t.onClick,o=t.onLike,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0);u.id=e._id;var i=u.querySelector(".card__delete-button"),a=u.querySelector(".card__like-button");c._id===e.owner._id?i.style.display="block":i.style.display="none",e.likes.some(function(e){return e._id===c._id})?a.classList.add("card__like-button_is-active"):a.classList.remove("card__like-button_is-active");var s=u.querySelector(".card__image");return s.src=e.link,s.alt=e.name,u.querySelector(".card__title").textContent=e.name,u.querySelector(".card__like-count").textContent=e.likes.length,i.addEventListener("click",n),s.addEventListener("click",r),a.addEventListener("click",o),u}function n(t){var n;(n=t.target.closest(".card").id,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка при попытке удаления карточки: ".concat(e.status))}).then(function(e){return e}).catch(function(e){return console.error(e)})).then(function(){t.target.closest(".card").remove()}).catch(function(e){return console.error(e)})}function r(t){var n,r,o=t.target.closest(".card");t.target.classList.contains("card__like-button_is-active")?(r=o.id,n=fetch("".concat(e.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:e.headers}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка при попытке снять лайк: ".concat(e.status))}).then(function(e){return e}).catch(function(e){return console.error(e)})):n=function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка при попытке поставить лайк: ".concat(e.status))}).then(function(e){return e}).catch(function(e){return console.error(e)})}(o.id),n.then(function(e){o.querySelector(".card__like-count").textContent=e.likes.length}),t.target.classList.toggle("card__like-button_is-active")}function o(e){e.classList.add("popup_is-opened");var t=function(t){return function(e,t){"Escape"===e.key&&c(t)}(t,e)};e._escapeHandler=t,document.addEventListener("keydown",t)}function c(e){e.classList.remove("popup_is-opened"),e._escapeHandler&&(document.removeEventListener("keydown",e._escapeHandler),e._escapeHandler=null)}function u(e){c(e)}function i(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),o.classList.remove(r),o.textContent=""}function a(e,t,n){!function(e){return e.some(function(e){return!e.validity.valid})}(e)?t.classList.remove(n):t.classList.add(n)}function s(e,t){t.formSelector;var n=t.inputSelector,r=t.submitButtonSelector,o=t.inactiveButtonClass,c=t.inputErrorClass,u=t.errorClass,s=Array.from(e.querySelectorAll(n)),l=e.querySelector(r);s.forEach(function(t){i(e,t,c,u)}),a(s,l,o)}var l,d,p,f,_,m,h,v=document.querySelector(".places__list"),y=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),b=document.querySelector(".profile__image"),k=document.querySelector(".profile__image-edit"),C=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),E=document.querySelector(".popup_type_edit .popup__close"),L=document.querySelector(".popup_type_new-card .popup__close"),g=document.querySelector(".popup_type_image .popup__close"),x=document.querySelector(".popup_type_avatar .popup__close"),j=document.querySelector(".popup_type_image"),P=document.querySelector(".popup_type_edit"),B=document.querySelector(".popup_type_new-card"),U=document.querySelector(".popup_type_avatar"),D=j.querySelector(".popup__image"),T=j.querySelector(".popup__caption"),w=P.querySelector(".popup__input_type_name"),A=P.querySelector(".popup__input_type_description"),H=document.forms["edit-profile"],N=P.querySelector(".popup__button"),O=B.querySelector(".popup__input_type_card-name"),J=B.querySelector(".popup__input_type_url"),M=document.forms["new-place"],G=B.querySelector(".popup__button"),V=U.querySelector(".popup__input_type_url"),z=document.forms["new-avatar"],F=U.querySelector(".popup__button"),I=[],K={},Q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function R(e){o(j),e.target.classList.contains("card__image")&&(D.src=e.target.src,D.alt=e.target.alt,T.textContent=e.target.alt)}function W(){w.value=y.textContent,A.value=S.textContent}Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{method:"GET",headers:e.headers}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка при попытке загрузки данных: ".concat(e.status))}).then(function(e){return e}).catch(function(e){return console.error(e)}),fetch("".concat(e.baseUrl,"/cards"),{method:"GET",headers:e.headers}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка при попытке загрузки данных: ".concat(e.status))}).then(function(e){return e}).catch(function(e){return console.error(e)})]).then(function(e){K=e[0],I=e[1]}).then(function(){y.textContent=K.name,S.textContent=K.about,b.src=K.avatar,I.forEach(function(e){v.append(t(e,{onDelete:n,onClick:R,onLike:r},K))})}).catch(function(e){return console.error("Ошибка: ".concat(e))}),d=(l=Q).formSelector,p=l.inputSelector,f=l.submitButtonSelector,_=l.inactiveButtonClass,m=l.inputErrorClass,h=l.errorClass,[H,M,z].forEach(function(e){e.addEventListener("submit",function(e){e.preventDefault()}),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);a(n,r,t.inactiveButtonClass),n.forEach(function(o){o.addEventListener("input",function(){a(n,r,t.inactiveButtonClass),function(e,t,n,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?i(e,t,n,r):function(e,t,n,r,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),c.textContent=n,c.classList.add(o)}(e,t,t.validationMessage,n,r)}(e,o,t.inputErrorClass,t.errorClass)})})}(e,{formSelector:d,inputSelector:p,submitButtonSelector:f,inactiveButtonClass:_,inputErrorClass:m,errorClass:h})}),H.addEventListener("submit",function(t){return function(t,n,r){t.preventDefault(),N.textContent="Сохранение...",N.disabled=!0,function(t,n){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t,about:n})}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка при попытке редактирования профиля: ".concat(e.status))}).then(function(e){return e}).catch(function(e){return console.error(e)})}(n,r).then(function(e){y.textContent=e.name,S.textContent=e.about}).catch(function(e){return console.error(e)}).finally(function(){N.textContent="Сохранить",N.disabled=!1,c(P)})}(t,w.value,A.value)}),M.addEventListener("submit",function(o){return function(o,u,i){o.preventDefault(),G.textContent="Сохранение...",G.disabled=!0,function(t,n){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:t,link:n})}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка при попытке добавления карточки: ".concat(e.status))}).then(function(e){return e}).catch(function(e){return console.error(e)})}(u,i).then(function(e){v.prepend(t(e,{onDelete:n,onClick:R,onLike:r},K))}).catch(function(e){return console.error(e)}).finally(function(){G.textContent="Сохранить",G.disabled=!1,M.reset(),c(B)})}(o,O.value,J.value)}),z.addEventListener("submit",function(t){return function(t,n){t.preventDefault(),F.textContent="Сохранение...",F.disabled=!0,function(t){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then(function(e){return e.ok?e.json():Promise.reject("Ошибка при попытке редактирования аватара: ".concat(e.status))}).then(function(e){return e}).catch(function(e){return console.error(e)})}(n).then(function(){b.src=n}).catch(function(e){return console.error(e)}).finally(function(){F.textContent="Сохранить",F.disabled=!1,z.reset(),c(U)})}(t,V.value)}),C.addEventListener("click",function(){W(),o(P)}),q.addEventListener("click",function(){return o(B)}),k.addEventListener("click",function(){return o(U)}),E.addEventListener("click",function(){c(P),W(),s(H,Q)}),L.addEventListener("click",function(){c(B),M.reset(),s(M,Q)}),g.addEventListener("click",function(){c(j)}),x.addEventListener("click",function(){c(U),z.reset(),s(z,Q)}),P.addEventListener("click",function(e){e.target===P&&(u(P),W(),s(H,Q))}),B.addEventListener("click",function(e){e.target===B&&(u(B),M.reset(),s(M,Q))}),j.addEventListener("click",function(e){e.target===j&&u(j)}),U.addEventListener("click",function(e){e.target===U&&(u(U),z.reset(),s(z,Q))})})();