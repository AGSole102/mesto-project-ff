(()=>{"use strict";var e={baseUrl:"https://mesto.nomoreparties.co/v1/higher-front-back-dev",headers:{authorization:"09c8855e-21c8-4804-bebe-281ce3fe62b4","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.onDelete,r=t.onClick,o=t.onLike,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0);a.id=e._id;var i=a.querySelector(".card__delete-button"),u=a.querySelector(".card__like-button");c._id===e.owner._id?i.style.display="block":i.style.display="none",e.likes.some(function(e){return e._id===c._id})?u.classList.add("card__like-button_is-active"):u.classList.remove("card__like-button_is-active");var s=a.querySelector(".card__image");return s.src=e.link,s.alt=e.name,a.querySelector(".card__title").textContent=e.name,a.querySelector(".card__like-count").textContent=e.likes.length,i.addEventListener("click",n),s.addEventListener("click",r),u.addEventListener("click",o),a}function r(n){var r;(r=n.target.closest(".card").id,fetch("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then(t)).then(function(){n.target.closest(".card").remove()}).catch(function(e){return console.error(e)})}function o(n){var r,o,c=n.target.closest(".card");n.target.classList.contains("card__like-button_is-active")?(o=c.id,r=fetch("".concat(e.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:e.headers}).then(t)):r=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then(t)}(c.id),r.then(function(e){c.querySelector(".card__like-count").textContent=e.likes.length,n.target.classList.toggle("card__like-button_is-active")}).catch(function(e){return console.error(e)})}function c(e){e.classList.add("popup_is-opened");var t=function(t){return function(e,t){"Escape"===e.key&&a(t)}(t,e)};e._escapeHandler=t,document.addEventListener("keydown",t)}function a(e){e.classList.remove("popup_is-opened"),e._escapeHandler&&(document.removeEventListener("keydown",e._escapeHandler),e._escapeHandler=null)}function i(e){a(e)}function u(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),o.classList.remove(r),o.textContent=""}function s(e,t){e.classList.add(t)}function l(e,t,n){!function(e){return e.some(function(e){return!e.validity.valid})}(e)?function(e,t){e.classList.remove(t)}(t,n):s(t,n)}function d(e,t){t.formSelector;var n=t.inputSelector,r=t.submitButtonSelector,o=t.inactiveButtonClass,c=t.inputErrorClass,a=t.errorClass,i=Array.from(e.querySelectorAll(n)),l=e.querySelector(r);i.forEach(function(t){u(e,t,c,a)}),s(l,o)}var p,_,f,m,v,y,h,S=document.querySelector(".places__list"),b=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),q=document.querySelector(".profile__image-edit"),E=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-button"),g=document.querySelector(".popup_type_edit .popup__close"),x=document.querySelector(".popup_type_new-card .popup__close"),B=document.querySelector(".popup_type_image .popup__close"),U=document.querySelector(".popup_type_avatar .popup__close"),D=document.querySelector(".popup_type_image"),T=document.querySelector(".popup_type_edit"),w=document.querySelector(".popup_type_new-card"),A=document.querySelector(".popup_type_avatar"),H=D.querySelector(".popup__image"),P=D.querySelector(".popup__caption"),N=T.querySelector(".popup__input_type_name"),O=T.querySelector(".popup__input_type_description"),j=document.forms["edit-profile"],J=T.querySelector(".popup__button"),M=w.querySelector(".popup__input_type_card-name"),G=w.querySelector(".popup__input_type_url"),V=document.forms["new-place"],z=w.querySelector(".popup__button"),F=A.querySelector(".popup__input_type_url"),I=document.forms["new-avatar"],K=A.querySelector(".popup__button"),Q=[],R={},W={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function X(e){c(D),e.target.classList.contains("card__image")&&(H.src=e.target.src,H.alt=e.target.alt,P.textContent=e.target.alt)}function Y(){N.value=b.textContent,O.value=C.textContent}Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{method:"GET",headers:e.headers}).then(t),fetch("".concat(e.baseUrl,"/cards"),{method:"GET",headers:e.headers}).then(t)]).then(function(e){R=e[0],Q=e[1]}).then(function(){b.textContent=R.name,C.textContent=R.about,k.src=R.avatar,Q.forEach(function(e){S.append(n(e,{onDelete:r,onClick:X,onLike:o},R))})}).catch(function(e){return console.error("Ошибка: ".concat(e))}),_=(p=W).formSelector,f=p.inputSelector,m=p.submitButtonSelector,v=p.inactiveButtonClass,y=p.inputErrorClass,h=p.errorClass,[j,V,I].forEach(function(e){e.addEventListener("submit",function(e){e.preventDefault()}),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);l(n,r,t.inactiveButtonClass),n.forEach(function(o){o.addEventListener("input",function(){l(n,r,t.inactiveButtonClass),function(e,t,n,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t,n,r):function(e,t,n,r,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),c.textContent=n,c.classList.add(o)}(e,t,t.validationMessage,n,r)}(e,o,t.inputErrorClass,t.errorClass)})})}(e,{formSelector:_,inputSelector:f,submitButtonSelector:m,inactiveButtonClass:v,inputErrorClass:y,errorClass:h})}),j.addEventListener("submit",function(n){return function(n,r,o){n.preventDefault(),J.textContent="Сохранение...",J.disabled=!0,function(n,r){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then(t)}(r,o).then(function(e){b.textContent=e.name,C.textContent=e.about,a(T)}).catch(function(e){return console.error(e)}).finally(function(){J.textContent="Сохранить",J.disabled=!1})}(n,N.value,O.value)}),V.addEventListener("submit",function(c){return function(c,i,u){c.preventDefault(),z.textContent="Сохранение...",z.disabled=!0,function(n,r){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:r})}).then(t)}(i,u).then(function(e){S.prepend(n(e,{onDelete:r,onClick:X,onLike:o},R)),V.reset(),a(w)}).catch(function(e){return console.error(e)}).finally(function(){z.textContent="Сохранить",z.disabled=!1})}(c,M.value,G.value)}),I.addEventListener("submit",function(n){return function(n,r){n.preventDefault(),K.textContent="Сохранение...",K.disabled=!0,function(n){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then(t)}(r).then(function(){k.src=r,I.reset(),a(A)}).catch(function(e){return console.error(e)}).finally(function(){K.textContent="Сохранить",K.disabled=!1})}(n,F.value)}),E.addEventListener("click",function(){Y(),c(T)}),L.addEventListener("click",function(){return c(w)}),q.addEventListener("click",function(){return c(A)}),g.addEventListener("click",function(){a(T),Y(),d(j,W)}),x.addEventListener("click",function(){a(w),V.reset(),d(V,W)}),B.addEventListener("click",function(){a(D)}),U.addEventListener("click",function(){a(A),I.reset(),d(I,W)}),T.addEventListener("click",function(e){e.target===T&&(i(T),Y(),d(j,W))}),w.addEventListener("click",function(e){e.target===w&&(i(w),V.reset(),d(V,W))}),D.addEventListener("click",function(e){e.target===D&&i(D)}),A.addEventListener("click",function(e){e.target===A&&(i(A),I.reset(),d(I,W))})})();